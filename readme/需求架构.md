## 一、项目名称
本地智能文件内容搜索系统，名称叫做：找我呀

## 二、项目目标
开发一款安装在本地电脑上的图形化客户端应用（打包出来的exe、dmg），实现对本地文件内容的自然语言语义搜索。系统支持多种文件格式和图像内容的解析、向量化、存储与检索，采用 Python 技术栈结合 LangChain 框架构建，使用向量嵌入模型（如通义千问Embedding API），保障用户隐私，可离线运行。

用户使用流程：
1. 安装软件
2. 选择要索引的文件夹
3. 索引完成
4. 用户输入要搜索的文案
5. 显示匹配上的文件，输出给用户

## 三、已实现功能

### 后端功能
- **文件解析**：支持txt、pdf、docx、pptx、xlsx等格式文件的内容提取
- **向量化**：使用通义千问Embedding API进行文档向量化
- **向量数据库**：使用FAISS存储文档向量，支持高效的相似度搜索
- **文件路径管理**：记录并管理文档的元数据信息，包括索引目录路径、索引状态及索引时间
- **文件监控**：自动监控已索引目录的文件变动，实时更新索引
- **错误处理**：健壮的错误处理机制，确保各种异常情况下程序仍能正常运行
- **自动索引更新**：检测文件变化并自动更新索引，确保搜索结果始终是最新的
- **索引数据清理**：一键清理所有索引数据，方便处理存量或错误数据
- **文件统计跟踪**：索引过程中详细跟踪和记录文件处理状态（成功/失败/跳过）
- **文件大小优化**：支持处理最大100MB的文件，提升对大文件的覆盖面
- **智能分批处理**：将文本块分批处理，避免API限制错误，提高系统稳定性
- **文本块长度优化**：智能检测和调整文本块长度，确保符合API限制

### 前端界面
- **用户友好界面**：使用Electron + React实现桌面客户端，提供直观的用户体验
- **目录管理功能**：
  - 添加新目录
  - 删除目录
  - 为目录创建索引
  - 重建索引
  - 一键清理所有索引数据
- **索引状态显示**：实时显示每个目录的索引进度、状态和索引时间
- **索引统计信息**：展示文件处理详情，包括成功、失败和跳过的文件数量
- **搜索功能**：用户输入自然语言查询，返回相关文档片段和源文件位置
- **文件浏览**：从搜索结果直接打开原始文件
- **系统托盘支持**：关闭窗口时应用继续在后台运行，通过系统托盘快速访问
- **多平台支持**：支持Windows、macOS和Linux系统

### 基础架构
- **自动Python环境管理**：首次启动时自动下载和安装所需的Python环境和依赖
- **国内镜像源支持**：自动配置国内镜像源，加速依赖安装
- **轻量化安装包**：应用打包体积小，安装迅速
- **启动优化**：优化应用启动速度，减少资源占用
- **多平台构建**：支持为Windows、macOS和Linux平台打包发布

## 四、技术实现
🔧 后端模块（Python 实现）：

| 模块 | 功能 | 实现工具 |
|------|------|------------|
| 文件解析器 | 提取文本内容 | TextLoader, PyPDFLoader, UnstructuredWordDocumentLoader, 自定义Excel/PowerPoint加载器 |
| 向量化模块 | 文本向量化 | DashScopeEmbeddings (通义千问API) |
| 向量数据库 | 存储文档分块向量 | FAISS |
| 检索模块 | 用相似度返回相关文档段落 | FAISS.similarity_search_with_score |
| 文件监控 | 监控文件变动 | Watchdog |
| 文件路径管理 | 映射向量与原始文件路径 | 自定义元数据管理 |
| API服务 | 提供REST API | FastAPI + Uvicorn |
| 索引管理 | 索引数据清理与重建 | FastAPI + 文件系统操作 |
| 批处理优化 | 智能分批处理文本块 | 自定义批处理算法 |
| 文本长度控制 | 文本块长度检查与截断 | 自定义长度控制逻辑 |
| 文件统计 | 索引过程文件统计 | 状态追踪和统计记录 |

🧑‍💻 用户界面：

| 组件 | 技术 | 说明 |
|------|------|------|
| 前端框架 | React | 构建交互式用户界面 |
| UI组件库 | Material-UI | 提供现代化UI组件 |
| 桌面封装 | Electron | 将Web应用打包为桌面应用 |
| 状态管理 | React Hooks | 管理应用状态 |
| 系统托盘 | Electron Tray API | 系统托盘集成 |
| 后台运行 | Electron Background Process | 允许应用在后台持续运行 |
| 进度展示 | 自定义进度组件 | 显示索引进度和文件统计 |
| 设置界面 | 自定义设置对话框 | 提供系统配置和索引清理功能 |

## 五、系统架构
系统采用以下架构：

1. **前端层**：
   - React + Material-UI构建用户界面
   - Axios进行API通信
   - 组件化设计，包括目录管理、搜索结果展示等

2. **桌面应用层**：
   - Electron将Web应用打包为桌面应用
   - 提供系统托盘支持
   - 管理后台进程和主窗口
   - 处理应用生命周期事件

3. **后端服务层**：
   - FastAPI提供RESTful API
   - 处理文档解析、向量化和检索
   - 实现文件监控和索引更新
   - 错误处理和日志记录
   - 提供索引统计和管理接口

4. **存储层**：
   - FAISS向量数据库存储文档向量
   - 本地文件系统存储索引和配置
   - 索引元数据管理

5. **Python环境管理**：
   - 动态Python环境安装和配置
   - 依赖管理和初始化

## 六、优势特点

1. **完全本地化**：除向量嵌入外，所有处理均在本地进行，保护用户隐私
2. **语义搜索**：理解用户意图，而不只是关键词匹配
3. **多文件格式支持**：处理各种常见文档格式
4. **实时索引更新**：文件变动时自动更新索引
5. **跨平台兼容**：支持Windows、macOS和Linux
6. **后台持续运行**：关闭窗口后仍在后台运行，随时可用
7. **自动环境配置**：首次启动时自动设置所需环境
8. **高效文件处理**：支持处理大型文件，文件处理能力达到100MB
9. **稳定的索引机制**：分批处理和长度控制确保API调用稳定性
10. **全面的索引管理**：提供索引清理和重建功能，方便维护

## 七、未来发展方向

1. **离线向量化**：集成本地向量嵌入模型，实现完全离线使用
2. **搜索结果增强**：添加文件预览、结果高亮等功能
3. **更多文件格式支持**：扩展对更多文档格式的支持
4. **用户自定义配置**：允许用户自定义索引参数、搜索相关度等
5. **智能文件分类**：基于内容自动分类文件
6. **多语言支持**：添加更多语言的界面本地化
7. **增强批处理能力**：进一步优化大量文件的处理性能
8. **索引压缩功能**：开发索引压缩技术，减少磁盘占用

# 依赖管理架构

## 设计目标
* 提供稳定可靠的应用运行环境
* 按需安装依赖，优化用户体验
* 区分必要核心依赖和可选功能依赖
* 优化依赖安装过程，使用国内镜像加速
* 确保核心依赖必须安装成功，保障应用基本功能

## 依赖分类

依赖被明确分为以下几类：

### 基础依赖和核心服务
* **基础工具**：watchdog (文件监控), httpx (网络请求), orjson (高效JSON处理)
* **API服务**：fastapi, uvicorn (提供Web服务)
* **AI服务**：dashscope (通义千问API服务)

### 向量数据库依赖
* faiss-cpu (高效向量检索库)
* langchain相关库 (提供向量化和检索功能)

### 文档处理依赖
* **Word文档**：python-docx
* **Excel文档**：pandas, openpyxl
* **PPT文档**：python-pptx
* **PDF文档**：PyPDF2, PyMuPDF, pdfminer.six
* **图像文档**：Pillow, pytesseract (OCR识别)

## 依赖管理机制

### 初始化检查
1. 应用启动时检查Python环境是否安装
2. 如果未安装，提供自动安装选项（使用Miniconda）
3. 检查核心依赖是否安装
4. 区分核心依赖和文档处理依赖，分别处理

### 运行时检测
1. 应用运行时监控Python进程输出
2. 自动检测ImportError和模块缺失错误
3. 根据缺失依赖的类型提供不同的安装选项
4. 优先处理核心依赖，确保应用基本功能可用

### 依赖安装流程
1. 使用多个国内镜像源，按优先级顺序尝试安装
2. 提供清晰的安装进度和状态反馈
3. 安装完成后根据情况提供重启选项
4. 处理安装失败情况，提供备选解决方案

### 强制安装机制
1. 对核心依赖使用强制安装窗口，不允许用户取消安装
2. 专用安装窗口实时显示安装进度和日志
3. 多镜像源自动切换，确保最高安装成功率
4. 安装窗口无法关闭，确保依赖安装过程不被中断
5. 对可选依赖保留用户选择权，允许稍后安装

## 环境隔离
应用使用独立的Python环境（~/.findmeapp/python），与系统Python隔离，确保稳定性和兼容性
```